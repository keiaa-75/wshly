<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/layout :: head}"></head>
<body class="bg-gradient-to-br from-pink-50 to-red-50 min-h-screen font-aux-dotbitc">
    
    <!-- Card Display (when card exists) -->
    <div th:if="${card != null}" class="flex items-center justify-center min-h-screen p-4">
        <!-- Holiday Card -->
        <div class="bg-white rounded-lg shadow-xl border-4 border-cherry-400 p-6 max-w-sm mx-auto relative overflow-hidden">
            <div class="absolute inset-2 border-2 border-pink-300 rounded pointer-events-none"></div>
            
            <!-- Card Content -->
            <div class="relative z-10 text-center space-y-4">
                <!-- Main Message -->
                <h1 class="font-superhelio text-lg text-cherry-600 leading-relaxed pixel-shadow font-bold" 
                    th:text="${card.mainMessage.displayText}">Merry Christmas!</h1>
                
                <!-- To Line -->
                <div class="space-y-1">
                    <p class="font-aux-dotbitc text-gray-600 text-lg">TO:</p>
                    <p class="font-superhelio text-xl text-pink-600 font-bold" 
                       th:text="${card.recipientName}">Someone Special</p>
                </div>
                
                <!-- Custom Message -->
                <div th:if="${card.customMessage != null and !card.customMessage.isEmpty()}" 
                     class="bg-pink-50 border-2 border-pink-200 rounded p-3 mx-2">
                    <p class="font-aux-dotbitc text-gray-700 text-base leading-relaxed" 
                       th:text="${card.customMessage}">Custom message here</p>
                </div>
                
                <!-- From Line -->
                <div class="space-y-1 pt-2">
                    <p class="font-aux-dotbitc text-gray-600 text-lg">FROM:</p>
                    <p class="font-superhelio text-xl text-cherry-600 font-bold" 
                       th:text="${card.senderName}">Your Name</p>
                </div>
            </div>
            
            <!-- Pixel decorative corners -->
            <div class="absolute top-1 left-1 w-3 h-3 bg-cherry-300"></div>
            <div class="absolute top-1 right-1 w-3 h-3 bg-pink-300"></div>
            <div class="absolute bottom-1 left-1 w-3 h-3 bg-pink-300"></div>
            <div class="absolute bottom-1 right-1 w-3 h-3 bg-cherry-300"></div>
        </div>
        
        <!-- Floating Action Buttons -->
        <div class="fixed bottom-6 left-6 space-y-3">
            <button onclick="copyCardLink()" 
                    class="block bg-gradient-to-r from-cherry-500 to-cherry-600 text-white font-superhelio font-bold px-4 py-3 rounded-lg hover:from-cherry-600 hover:to-cherry-700 transition-colors shadow-lg">
                COPY
            </button>
            
            <a th:href="@{/?f=1}" 
               class="block bg-gradient-to-r from-pink-500 to-red-500 text-white font-superhelio font-bold px-4 py-3 rounded-lg hover:from-pink-600 hover:to-red-600 transition-colors shadow-lg text-center">
                NEW
            </a>
        </div>
    </div>
    
    <!-- Form Layout (when no card or form is visible) -->
    <div th:if="${card == null or showForm}" class="relative min-h-screen overflow-hidden">
        
        <!-- Card Preview - Full screen, always centered -->
        <div class="absolute inset-0 md:left-80 flex items-center justify-center p-4 transition-all duration-300" id="preview-area">
            <div class="w-full max-w-sm">
                <h2 class="font-superhelio text-2xl text-center text-red-600 mb-4 font-bold">PREVIEW</h2>
                <!-- Preview Card (updated by jQuery) -->
                <div class="bg-white rounded-lg shadow-xl border-4 border-cherry-400 p-6 relative overflow-hidden">
                    <div class="absolute inset-2 border-2 border-pink-300 rounded pointer-events-none"></div>
                    <div id="card-preview" class="relative z-10 text-center space-y-4">
                        <h3 class="font-superhelio text-lg text-cherry-600 leading-relaxed pixel-shadow font-bold">Merry Christmas!</h3>
                        <div class="space-y-1">
                            <p class="font-aux-dotbitc text-gray-600 text-lg">TO:</p>
                            <p class="font-superhelio text-xl text-pink-600 font-bold">Someone Special</p>
                        </div>
                        <div class="space-y-1 pt-2">
                            <p class="font-aux-dotbitc text-gray-600 text-lg">FROM:</p>
                            <p class="font-superhelio text-xl text-cherry-600 font-bold">You</p>
                        </div>
                    </div>
                    <!-- Pixel decorative corners -->
                    <div class="absolute top-1 left-1 w-3 h-3 bg-cherry-300"></div>
                    <div class="absolute top-1 right-1 w-3 h-3 bg-pink-300"></div>
                    <div class="absolute bottom-1 left-1 w-3 h-3 bg-pink-300"></div>
                    <div class="absolute bottom-1 right-1 w-3 h-3 bg-cherry-300"></div>
                </div>
            </div>
        </div>
        
        <!-- Settings Form - Slides in from bottom (mobile) / left (desktop) -->
        <div id="form-pane" class="fixed bottom-0 left-0 md:top-0 w-full md:w-80 p-4 bg-white border-t-2 md:border-t-0 md:border-r-2 border-pink-200 transition-transform duration-300 ease-in-out z-20">
            <!-- Tab Handle -->
            <button id="form-toggle" class="absolute -top-8 left-1/2 transform -translate-x-1/2 md:top-1/2 md:-translate-y-1/2 md:left-full md:translate-x-0 bg-white border-2 border-pink-200 border-b-0 md:border-b-2 md:border-l-0 rounded-t-lg md:rounded-l-none md:rounded-r-lg px-3 py-2 md:px-2 md:py-3 hover:bg-pink-50 transition-colors z-30">
                <div class="flex items-center justify-center">
                    <svg id="toggle-icon" class="w-4 h-4 text-cherry-600 transition-transform duration-300 md:rotate-90" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </div>
                <!-- Dotted detail -->
                <div class="absolute inset-1 border border-dotted border-pink-300 rounded pointer-events-none"></div>
            </button>
            
            <h1 class="font-superhelio text-2xl text-red-600 mb-6 text-center md:text-left font-bold">CREATE CARD</h1>
            
            <form action="/card" method="get" class="space-y-4">
                <input type="hidden" name="f" value="0">
                
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1 font-aux-dotbitc text-base">FROM:</label>
                    <input type="text" name="senderName" placeholder="Your name" required
                           class="w-full px-3 py-2 border border-pink-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-400 font-superhelio">
                </div>
                
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1 font-aux-dotbitc text-base">TO:</label>
                    <input type="text" name="recipientName" placeholder="Recipient name" required
                           class="w-full px-3 py-2 border border-pink-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-400 font-superhelio">
                </div>
                
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1 font-aux-dotbitc text-base">MESSAGE:</label>
                    <select name="mainMessage" 
                            class="w-full px-3 py-2 border border-pink-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-400 font-superhelio">
                        <option th:each="message : ${messages}" 
                                th:value="${message}" 
                                th:text="${message.displayText}">
                        </option>
                    </select>
                </div>
                
                <div>
                    <label class="block text-sm font-bold text-gray-700 mb-1 font-aux-dotbitc text-base">CUSTOM MESSAGE:</label>
                    <textarea name="customMessage" placeholder="Add your personal touch..." maxlength="150"
                              class="w-full px-3 py-2 border border-pink-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-pink-400 h-20 resize-none font-superhelio"></textarea>
                </div>
                
                <button type="button" id="copyLink"
                        class="w-full bg-gradient-to-r from-pink-500 to-red-500 text-white font-bold py-3 rounded-lg hover:from-pink-600 hover:to-red-600 transition-colors font-superhelio">
                    COPY SHAREABLE LINK
                </button>
            </form>
        </div>
        
    </div>
    
    <script th:if="${card == null or showForm}" src="/js/card-creator.js"></script>
    
    <script th:if="${card == null or showForm}">
        // Form pane toggle functionality
        $(document).ready(function() {
            const $formPane = $('#form-pane');
            const $toggleIcon = $('#toggle-icon');
            const $previewArea = $('#preview-area');
            let isCollapsed = false;
            
            // Get form height for mobile adjustment
            const formHeight = $formPane.outerHeight();
            const isMobile = () => window.innerWidth < 768;
            
            $('#form-toggle').click(function() {
                isCollapsed = !isCollapsed;
                
                if (isCollapsed) {
                    // Collapse - slide form out
                    $formPane.addClass('translate-y-full md:translate-y-0 md:-translate-x-full');
                    $toggleIcon.addClass('rotate-180').removeClass('md:rotate-90').addClass('md:-rotate-90');
                    // Preview adjustments
                    $previewArea.removeClass('md:left-80').addClass('md:left-0');
                    if (isMobile()) {
                        $previewArea.css('bottom', '0');
                    }
                } else {
                    // Expand - slide form in
                    $formPane.removeClass('translate-y-full md:translate-y-0 md:-translate-x-full');
                    $toggleIcon.removeClass('rotate-180 md:-rotate-90').addClass('md:rotate-90');
                    // Preview adjustments
                    $previewArea.removeClass('md:left-0').addClass('md:left-80');
                    if (isMobile()) {
                        $previewArea.css('bottom', formHeight + 'px');
                    }
                }
            });
            
            // Set initial bottom on mobile
            if (isMobile()) {
                $previewArea.css('bottom', formHeight + 'px');
            }
        });
    </script>
    
    <script th:if="${card != null}">
        function copyCardLink() {
            navigator.clipboard.writeText(window.location.href).then(() => {
                const btn = event.target;
                const originalText = btn.textContent;
                btn.textContent = 'COPIED!';
                btn.className = btn.className.replace('from-cherry-500 to-cherry-600', 'from-green-500 to-green-600');
                setTimeout(() => {
                    btn.textContent = originalText;
                    btn.className = btn.className.replace('from-green-500 to-green-600', 'from-cherry-500 to-cherry-600');
                }, 2000);
            });
        }
    </script>
    
    <style>
        .pixel-shadow {
            text-shadow: 2px 2px 0px rgba(220, 38, 38, 0.3);
        }
        
        /* Ensure form pane stays above other content when collapsed */
        #form-pane {
            z-index: 10;
        }
        
        /* Hide form content when collapsed on mobile */
        #form-pane.translate-y-full > *:not(#form-toggle) {
            opacity: 0;
            transition: opacity 0.2s ease-in-out;
        }
        
        /* Hide form content when collapsed on desktop */
        @media (min-width: 768px) {
            #form-pane.-translate-x-full > *:not(#form-toggle) {
                opacity: 0;
                transition: opacity 0.2s ease-in-out;
            }
        }
    </style>
</body>
</html>
